<html>
<head>

</head>

<style>
.dark {
 background: black;
 color: white;
}

.nodark {
 background: white;
}
</style>

<script>
vtable = [8,8];
orig_position="";
newposition="";

vempty = "img/empty.png";
vyellow="img/yellow.png";
vorange="img/orange.png";

/*
 for( let i = 0 ; i < 8; i++)
 {
   vtable[i, new Array(8) ];
 }

function run(){

 vtable = [8];

 for( let i = 0 ; i < 8; i++)
 {
   vtable[i, new Array(8) ];
 }

}
*/

function load(){

   tmp="<table style='width: 850px; height:850px;' border='1'>";
   lastclass="";
   
   totalPieces = 12;
   totalSpaces =
   
   pieceYellow = 0;
   pieceNonYellow = 0;
   
   for(let i=0; i < 8; i++)
   {
      tmp += "<tr>";
	  
	  figure = "<img id='piece' src='' />";
	  
	  if( lastclass == "dark" )
		{
		  lastclass = "nodark";
		}else
        {
		  lastclass = "dark";
		}
	  
	  for(let k=0; k < 8; k++)
	  {
	    img1=""; 
	    figure = "";
		
		vid = "\"position-" + i + "-" + k + "\"";
		
	    if( lastclass == "dark" )
		{
		  lastclass = "nodark";
		  
		}else
        {
		  lastclass = "dark";
		  img1 = vempty;
		  
		  if( k == 0 || k == 1 || k == 2 )
		  {
			  img1= vyellow;
		  }
		  else if( k == 5 || k == 6 || k == 7 )
		  {
			 img1=vorange;
		  }
		  
		  figure = "<center><img onclick='movepiece(" + vid + ");' id=" + vid + " style='color: white;' src='" + img1 + "' /> " + vid + " </center>";
		}

		//vtable[ i , k ] = lastclass == "dark"?"dark":"nodark";

		tmp += "<td class='" + lastclass + "'> "  + figure + " </td>";
	  }
	  
	  tmp += "</tr>";
	  
   }
   tmp+="</table>";
   
   document.getElementById("ground").innerHTML = tmp;   
}



function getPosition(lin,col){
  vpos = "position-" + lin + "-" + col ;
  return vpos;
}

function getLine(strpos){
  vline = parseInt( strpos.split('-')[1] );
  return vline;
}

function getCol(strpos){
  vcol = parseInt( strpos.split('-')[2] );
  return vcol;
}

function PositionIsEmpty(strposition){
  resp = false;
  if( document.getElementById(strposition).src.indexOf("empty") != -1 )
    resp = true;
  return resp;
}

function PositionIsYellow(strposition){
  resp = false;
  if( document.getElementById(strposition).src.indexOf("yellow") != -1 )
    resp = true;
  return resp;
}

function PositionIsOrange(strposition){
  resp = false;
  if( document.getElementById(strposition).src.indexOf("orange") != -1 )
    resp = true;
  return resp;
}

function movePosition(newPos,oldPos,strpiece){
  //document.getElementById(oldPos).src = vempty;
  //document.getElementById(newPos).src = strpiece;
  
  setPosition(oldPos,vempty);
  setPosition(newPos,strpiece);
  
  document.getElementById("pposition").innerText = "From:"+ oldPos + " To: " + newPos;
}

function setPosition(sPosition,spiece){
  document.getElementById(sPosition).src = spiece; 
}

function getPiece(sPosition){
  ret = "";
  ret = document.getElementById(sPosition).src 
  ret = ret.split('/')[ ret.split('/').length -2 ] + "/" + ret.split('/')[ ret.split('/').length -1 ]
  return ret;
}

function addScore(spiece){
  
  scordid = "";
  score = 0;
  txtscore = "";
  
  if( spiece == vyellow )
  {
    scordid = "scoreYellow";
	txtscore = "Yellow:";
  
  }else
  {
    scordid = "scoreOragne";
	txtscore = "Oragne:";
  }
  
  score = parseInt( document.getElementById(scordid).innerText.split(":")[1] );
  score += 1;
  
  document.getElementById(scordid).innerText = txtscore + score;
  
}


function movepiece(vnextpos){

    maxline = 7;
	maxcol = 7;
	minline = 0;
	mincol = 0;
	
	orig_line = -1;
	orig_col = -1;
	
	new_line = -1;
	new_col = -1;
	
	middle_position="position-0-0";
	

   if( orig_position == "" ){
      orig_position = vnextpos; //This was the first click so, we don't have yet the destination
	  vnextpos = "";
	  return;
    }
	
	if( orig_position != ""  && vnextpos != "" ){
	    if( !PositionIsEmpty( vnextpos ) ){
		   alert( "Only move to a empty position !");
		   orig_position="";
		   return;
		} 
	}
	
    orig_line = getLine( orig_position );
 	orig_col = getCol(orig_position );
	
	if( vnextpos != "" ){
	  new_line = getLine( vnextpos);
 	  new_col = getCol( vnextpos );
	}
	
	if( new_line == orig_line ){
	   alert("You cannot move in the same line"); 
	   orig_position="";
	   return;
	}
	
	if( new_col == orig_col ){
	   alert("You cannot move in the same column"); 
	   orig_position="";
	   return;
	}
	
	//The maximun position allowed to jum is 3 --  this i snot working ... check tomorrow
	if( (new_line - orig_line ) > 3 || (new_line - orig_line ) < -3 ){
	    alert("Only move three positions!"); 
	    orig_position="";
		return;
	}
	
	if(PositionIsOrange(orig_position)){
	    vpiece=vorange;
		
	   //Don't go backwards
	   if(  new_col > orig_col )
	   {
	     alert("You cannot go back!");
		 orig_position="";
		 return;
	   }
		
	}
	else
	{
	   vpiece=vyellow;
	   
	   //Don't go backwards
	   if( new_col < orig_col )
	   {
	     alert("You cannot go back!");
		 orig_position="";
		 return;
	   }
	}
	
	
	if( (new_col - orig_col) == 2 || (orig_col - new_col) == 2 )
	{
	  //if some value is negative this means that the movement is from
	  //orange piece.
	  
	  if(vpiece == vorange)
	  {
	    //if the line that I am going to is less than the line where I am then
		if(new_line < orig_line)
		{
		   middle_col = new_col + 1;
           middle_line = new_line + 1;
		}else 
		  if(new_line > orig_line) //if the line that I am going to is bigger than the line where I am then
		  {
		    middle_col = new_col + 1;
            middle_line = new_line - 1; 		   
		  }
	  }else if(vpiece == vyellow)
	  {
	    if(new_line < orig_line)
		{
		   middle_col = new_col - 1;
           middle_line = new_line + 1;
		}else 
		  if(new_line > orig_line) //if the line that I am going to is bigger than the line where I am then
		  {
		    middle_col = new_col - 1;
            middle_line = new_line - 1; 		   
		  }

	  }
	  
	  middle_position="position-" + middle_line + "-" + middle_col;
	  
	  if(PositionIsEmpty(middle_position))
	  {
	    alert("You cannot jump over an empty position");
		orig_position="";
		middle_position="";
		return;
	  }
	  
	  
	  if( vpiece == getPiece(middle_position) )
	  {
	    alert("YOu cannot jump over a collegue!");
		orig_position="";
		middle_position="";
		return;
	  }
	  
	  //Score one point
	  setPosition(middle_position,vempty);
	  addScore(vpiece);
	}
	
	movePosition(vnextpos,orig_position,vpiece );
	
	console.log("Origin:" + orig_position );
	console.log("Middle:" + middle_position );
	console.log("Next:" + vnextpos );
	
	
	orig_position="";  
	middle_position="";
}

</script>

<body onload="load();">

<div id="ground">

</div>

<p id="pposition">Position:</p>
<p id="scoreYellow">Yellow:0</p>
<p id="scoreOragne">Orange:0</p>

</body>
</html>

